<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>GATO ROBOT CORE INPUT STUDY</title>
<style>
html,body{
  margin:0;
  background:#000;
}
canvas{
  display:block;
  margin:auto;
  background:#000;
}
</style>
</head>
<body>

<canvas id="c" width="640" height="360"></canvas>

<script>
/* ========= 基本設定 ========= */
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");

/* ========= 入力 ========= */
const input = {
  left:false,
  right:false,
  jump:false,
  jumpPressed:false
};

window.addEventListener("keydown",e=>{
  if(e.code==="ArrowLeft") input.left = true;
  if(e.code==="ArrowRight") input.right = true;
  if(e.code==="KeyZ"){
    if(!input.jump) input.jumpPressed = true;
    input.jump = true;
  }
});
window.addEventListener("keyup",e=>{
  if(e.code==="ArrowLeft") input.left = false;
  if(e.code==="ArrowRight") input.right = false;
  if(e.code==="KeyZ") input.jump = false;
});

/* ========= マップ ========= */
const TILE = 32;
const map = [
"####################",
"#..................#",
"#..................#",
"#......####........#",
"#..................#",
"#..................#",
"#......######......#",
"#..................#",
"#..................#",
"####################"
];

/* ========= プレイヤー ========= */
const player = {
  x:64,
  y:64,
  vx:0,
  vy:0,
  w:16,
  h:16,
  onGround:false
};

/* ========= 定数（GATO感） ========= */
const SPEED = 2.8;
const GRAVITY = 0.7;
const JUMP_VEL = -9;

/* ========= 衝突 ========= */
function solid(px,py){
  const tx = Math.floor(px/TILE);
  const ty = Math.floor(py/TILE);
  if(ty<0||ty>=map.length||tx<0||tx>=map[0].length) return true;
  return map[ty][tx]==="#";
}

/* ========= 更新 ========= */
function update(){
  /* --- 意図 → 速度 --- */
  player.vx = 0;
  if(input.left) player.vx = -SPEED;
  if(input.right) player.vx = SPEED;

  /* --- ジャンプ（押した瞬間だけ） --- */
  if(input.jumpPressed && player.onGround){
    player.vy = JUMP_VEL;
    player.onGround = false;
  }
  input.jumpPressed = false;

  /* --- 重力 --- */
  player.vy += GRAVITY;

  /* --- X移動 --- */
  player.x += player.vx;
  if(
    solid(player.x,player.y) ||
    solid(player.x+player.w,player.y) ||
    solid(player.x,player.y+player.h) ||
    solid(player.x+player.w,player.y+player.h)
  ){
    player.x -= player.vx;
  }

  /* --- Y移動 --- */
  player.y += player.vy;
  if(
    solid(player.x,player.y+player.h) ||
    solid(player.x+player.w,player.y+player.h)
  ){
    player.y = Math.floor((player.y+player.h)/TILE)*TILE-player.h;
    player.vy = 0;
    player.onGround = true;
  }
}

/* ========= 描画 ========= */
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  /* マップ */
  ctx.strokeStyle="#444";
  for(let y=0;y<map.length;y++){
    for(let x=0;x<map[y].length;x++){
      if(map[y][x]==="#"){
        ctx.strokeRect(x*TILE,y*TILE,TILE,TILE);
      }
    }
  }

  /* プレイヤー */
  ctx.fillStyle="#eee";
  ctx.fillRect(player.x,player.y,player.w,player.h);
}

/* ========= ループ ========= */
function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
}
loop();
</script>

</body>
</html>



