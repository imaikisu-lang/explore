<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>GATO ROBOT STUDY v2</title>
<style>
html,body{
  margin:0;
  background:#000;
  color:#888;
  font-family: monospace;
}
canvas{
  display:block;
  margin:0 auto;
  background:#000;
}
#hint{
  text-align:center;
  font-size:12px;
  margin:6px;
}
</style>
</head>
<body>

<canvas id="game" width="640" height="360"></canvas>
<div id="hint">← → 移動 / Z ジャンプ / X スーツ切替</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const TILE = 32;
const GRAVITY = 0.5;
const SPEED = 2.2;
const JUMP = -8;

const map = [
"####################",
"#..................#",
"#..............S...#",
"#......####........#",
"#..................#",
"#..N...............#",
"#......######......#",
"#..................#",
"#..............G...#",
"####################"
];

const player = {
  x:64, y:64,
  vx:0, vy:0,
  w:18, h:18,
  onGround:false,
  suit:true
};

const keys = {};

addEventListener("keydown",e=>{
  keys[e.code]=true;
});
addEventListener("keyup",e=>{
  keys[e.code]=false;
});

function tileAt(px,py){
  const tx = Math.floor(px/TILE);
  const ty = Math.floor(py/TILE);
  if(ty<0||ty>=map.length||tx<0||tx>=map[0].length) return "#";
  return map[ty][tx];
}

function solid(px,py){
  const t = tileAt(px,py);
  if(t==="#") return true;
  if(t==="S" && !player.suit) return true; // 狭い通路
  if(t==="N" && player.suit) return true;  // スーツだと通れない
  return false;
}

function update(){
  // 左右（即反応・即停止）
  player.vx = 0;
  if(keys["ArrowLeft"]) player.vx = -SPEED;
  if(keys["ArrowRight"]) player.vx = SPEED;

  // ジャンプ
  if(keys["KeyZ"] && player.onGround){
    player.vy = JUMP;
    player.onGround = false;
  }

  // スーツ切替
  if(keys["KeyX"]){
    player.suit = !player.suit;
    keys["KeyX"]=false;
  }

  player.vy += GRAVITY;

  // X移動
  player.x += player.vx;
  if(
    solid(player.x,player.y) ||
    solid(player.x+player.w,player.y) ||
    solid(player.x,player.y+player.h) ||
    solid(player.x+player.w,player.y+player.h)
  ){
    player.x -= player.vx;
  }

  // Y移動
  player.y += player.vy;
  if(
    solid(player.x,player.y+player.h) ||
    solid(player.x+player.w,player.y+player.h)
  ){
    player.y = Math.floor((player.y+player.h)/TILE)*TILE-player.h;
    player.vy = 0;
    player.onGround = true;
  }
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // マップ（線主体）
  ctx.strokeStyle="#444";
  for(let y=0;y<map.length;y++){
    for(let x=0;x<map[y].length;x++){
      const t = map[y][x];
      if(t==="#"){
        ctx.strokeRect(x*TILE,y*TILE,TILE,TILE);
      }
      if(t==="S"){
        ctx.strokeRect(x*TILE+8,y*TILE+8,16,16);
      }
      if(t==="N"){
        ctx.strokeRect(x*TILE+4,y*TILE+4,24,24);
      }
      if(t==="G"){
        ctx.fillStyle="#eee";
        ctx.beginPath();
        ctx.arc(x*TILE+16,y*TILE+16,6,0,Math.PI*2);
        ctx.fill();
      }
    }
  }

  // プレイヤー
  if(player.suit){
    ctx.fillStyle="#aaa";
    ctx.fillRect(player.x,player.y,player.w,player.h);
  }else{
    ctx.fillStyle="#eee";
    ctx.beginPath();
    ctx.arc(player.x+9,player.y+9,9,0,Math.PI*2);
    ctx.fill();
  }
}

function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
}
loop();
</script>

</body>
</html>

