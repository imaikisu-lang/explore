
<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>GATO ROBOT - Movement Test</title>
<style>
  body {
    margin: 0;
    background: #000;
    overflow: hidden;
  }
  canvas {
    display: block;
    background: #000;
  }
</style>
</head>
<body>

<canvas id="c"></canvas>

<script>
// =====================
// 基本セットアップ
// =====================
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");

canvas.width = 800;
canvas.height = 450;

// =====================
// 入力管理
// =====================
const key = {};
window.addEventListener("keydown", e => key[e.key] = true);
window.addEventListener("keyup",   e => key[e.key] = false);

// =====================
// プレイヤー
// =====================
const player = {
  x: 100,
  y: 300,
  w: 24,
  h: 24,
  vx: 0,
  vy: 0,

  speed: 0.6,      // 横加速
  maxSpeed: 4.0,   // 最大速度
  friction: 0.8,   // 地上減速
  gravity: 0.35,
  jumpPower: 7.5,

  onGround: false,

  coyoteTime: 6,   // 崖ジャンプ猶予
  coyoteTimer: 0,

  jumpBuffer: 6,   // 早押し猶予
  jumpBufferTimer: 0
};

// =====================
// 地面
// =====================
const groundY = 360;

// =====================
// メインループ
// =====================
function update() {

  // -----------------
  // 横移動
  // -----------------
  if (key["ArrowLeft"])  player.vx -= player.speed;
  if (key["ArrowRight"]) player.vx += player.speed;

  // 最大速度制限
  player.vx = Math.max(-player.maxSpeed, Math.min(player.vx, player.maxSpeed));

  // 摩擦（地上のみ）
  if (player.onGround && !key["ArrowLeft"] && !key["ArrowRight"]) {
    player.vx *= player.friction;
    if (Math.abs(player.vx) < 0.1) player.vx = 0;
  }

  // -----------------
  // ジャンプ入力
  // -----------------
  if (key["z"]) {
    player.jumpBufferTimer = player.jumpBuffer;
  }

  // -----------------
  // ジャンプ発動
  // -----------------
  if (player.jumpBufferTimer > 0 && player.coyoteTimer > 0) {
    player.vy = -player.jumpPower;
    player.jumpBufferTimer = 0;
    player.coyoteTimer = 0;
  }

  // -----------------
  // 重力
  // -----------------
  player.vy += player.gravity;

  // -----------------
  // 移動
  // -----------------
  player.x += player.vx;
  player.y += player.vy;

  // -----------------
  // 地面判定
  // -----------------
  if (player.y + player.h >= groundY) {
    player.y = groundY - player.h;
    player.vy = 0;
    player.onGround = true;
    player.coyoteTimer = player.coyoteTime;
  } else {
    player.onGround = false;
    player.coyoteTimer--;
  }

  player.jumpBufferTimer--;

  draw();
  requestAnimationFrame(update);
}

// =====================
// 描画
// =====================
function draw() {
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // 地面
  ctx.fillStyle = "#fff";
  ctx.fillRect(0, groundY, canvas.width, 4);

  // プレイヤー
  ctx.fillRect(player.x, player.y, player.w, player.h);

  // 操作説明
  ctx.font = "14px monospace";
  ctx.fillText("← → 移動 / Z ジャンプ", 20, 30);
}

update();
</script>

</body>
</html>




